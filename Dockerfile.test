# Use the official .NET SDK image for building and testing
FROM mcr.microsoft.com/dotnet/sdk:9.0

# Set the working directory inside the container
WORKDIR /app

# Copy the solution and project files
COPY *.sln ./
COPY HealthDevice/*.csproj ./HealthDevice/
COPY HealthDevice.Tests/*.csproj ./HealthDevice.Tests/

# Copy the rest of the source code
COPY HealthDevice/. ./HealthDevice/
COPY HealthDevice.Tests/. ./HealthDevice.Tests/

# Restore dependencies
RUN dotnet restore

# Build the solution
RUN dotnet build --no-restore

# Run the tests
CMD ["dotnet", "test", "--no-build", "--logger:trx"]